# Обработчики событий

Для удобства разработки AJAX-запросы бросают несколько событий, и их, естественно, можно и нужно обрабатывать. jQuery позволяет обрабатывать эти события для каждого AJAX-запроса и в отдельности и глобально. Приведу схемку, на которой наглядно виден порядок возникновения событий в jQuery:

<figure><img src="../.gitbook/assets/events.svg" alt=""><figcaption><p>AJAX Events</p></figcaption></figure>

Вот и полный список событий с небольшими ремарками:

<table><thead><tr><th width="195">событие</th><th>описание</th></tr></thead><tbody><tr><td><code>ajaxStart</code></td><td>данное событие возникает в случае, когда побежал первый AJAX-запрос, и при этом других активных AJAX-запросов в данный момент нет</td></tr><tr><td><code>beforeSend</code></td><td>возникает до отправки запроса, и позволяет редактировать XMLHttpRequest, локальное событие</td></tr><tr><td><code>ajaxSend</code></td><td>возникает до отправки запроса, как и <code>beforeSend</code></td></tr><tr><td><code>success</code></td><td>возникает по возвращении ответа, когда в нём нет ошибок, локальное событие</td></tr><tr><td><code>ajaxSuccess</code></td><td>возникает по возвращении ответа, аналогично событию <code>success</code></td></tr><tr><td><code>error</code></td><td>возникает в случае ошибки, локальное событие</td></tr><tr><td><code>ajaxError</code></td><td>возникает в случае ошибки</td></tr><tr><td><code>complete</code></td><td>возникает по завершении текущего AJAX-запроса при любом раскладе, локальное событие</td></tr><tr><td><code>ajaxComplete</code></td><td>глобальное событие, аналогичное <code>complete</code></td></tr><tr><td><code>ajaxStop</code></td><td>данное событие возникает в случае, когда больше нет активных AJAX-запросов</td></tr></tbody></table>

Пример для отображения элемента с `id="loading"` во время выполнения любого AJAX-запроса (т.е. мы обрабатываем глобальное событие):

```javascript
$(document).on("ajaxSend", function() {
    $("#loading").show(); // показываем элемент
}).on("ajaxStop", function(){
    $("#loading").hide(); // скрываем элемент
});
```

{% hint style="warning" %}
Это задачка по юзабилити – мы всегда должны держать пользователя сайта в курсе дела о происходящем на странице и отправка AJAX-запроса тоже попадает под разряд «must know». Подобное решение у вас будет практически на любом сайте, где ходит AJAX.
{% endhint %}

Для локальных событий – вносим изменения в опции метода `ajax()`:

```javascript
$.ajax({
    beforeSend: function() {
        // данный обработчик будет вызван перед отправкой данного AJAX-запроса
    },
    success: function() {
        // а этот при удачном завершении
    },
    error: function() {
        // этот при возникновении ошибки
    },
    complete: function() {
        // и по завершении запроса (удачном или нет)
    }
});
```

Можно глобальные обработчики отключить принудительно, используя флаг «`global`». Для этого выставляем его на `false` и пишем функционал в обход событий `ajaxStart` и `ajaxStop`:

```javascript
$.ajax({
    global: false,
    beforeSend: function() {
        // ...
    },
    success: function() {
        // ...
    },
    error: function() {
        // ...
    },
    complete: function() {
        // ...
    }
});
```

> Данная опция частенько помогает избежать конфликтов при работе с AJAX-запросами, но не стоит ей злоупотреблять.
